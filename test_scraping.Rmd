---
title: "test_scrape"
author: "Collin"
date: "3/1/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(rvest)
library(stringr)

```

```{r, eval = FALSE}
usethis::edit_r_environ("project")
```
Put down your password in the file, (replace XXXXXXXXXXXXXXXXXX with your password)
```
APIKey=JmRqoKUcjfvCh_DqsTvZjZsjRIHsCS1Dsb8tT4HxzE1ryYFgKeJmWE9VQtua2KZPVh0DxuEc9Zo1e_D7sVajDVI3EWYfHcOfEbeWBeoLYiu4HU9zIM2Jr6D9EsE5YHYx
```
One your are done, run the following line
```{r, eval = FALSE}
readRenviron(".Renviron")
```
Then your password could be retrieved by `Sys.getenv("DATABASEPW")`.

The `.Renviron` won't be pushed to the git repo because the file was specified in `.gitignore`.

```{r}
Sys.getenv("DATABASEPW")
Sys.getenv("ALPHA_VANTAGE_APIKEY")
```


```{r}

wiki_page = read_html("https://en.wikipedia.org/wiki/List_of_highest-grossing_films")
wiki_tables = wiki_page %>% html_nodes("table") %>% 
  html_table(fill=TRUE)

top_fifty = (wiki_tables[[1]]) %>% 
  select(-Peak)
top_fifty

```
```{r}
#GET the IMDB rankings of all these movies using the IMDB API (Actually I think its the Trakt API):
library(httr)
library(jsonlite)
# install.packages("tRakt")
# library(tRakt)

#test alpha vantage API:
str_glue("https://www.alphavantage.co/query?function=EARNINGS&symbol={symbol}&apikey={apikey}",symbol = "IBM", 
         apikey = Sys.getenv("ALPHA_VANTAGE_APIKEY") )


json = GET("https://www.alphavantage.co/query?function=EARNINGS&symbol=IBM&apikey=demo")
text = fromJSON(content(json,type = "text", encoding = "UTF-8"))
text$annualEarnings


api_call = GET(str_glue("https://www.alphavantage.co/query?function=EARNINGS&symbol={symbol}&apikey={apikey}",symbol = "IBM", 
         apikey = Sys.getenv("ALPHA_VANTAGE_APIKEY") ))
data = fromJSON(content(api_call, type = "text", encoding = "UTF-8"))
data$annualEarnings

#make sure they're the same:
identical(text,data)




```


```{r}




```

